@model IEnumerable<FitnessCenterProject.Models.TrainerApiResult>

@{
    ViewData["Title"] = "Müsait Eğitmen Sorgulama";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">

    <div class="card shadow-lg border-0 bg-dark text-white mb-5">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0"><i class="fas fa-search me-2"></i> @ViewData["Title"]</h2>
        </div>

        <div class="card-body">
            <p class="text-secondary mb-4">
                Belirlediğiniz tarih ve saatte müsait olan eğitmenleri görmek için sorgulama yapın.
            </p>

            <form asp-action="AvailableTrainers" method="get" class="row g-3 align-items-end p-3 bg-secondary rounded shadow-sm">

                <input type="hidden" name="serviceId" value="@(ViewBag.ServiceId ?? 3)" />

                <div class="col-md-3">
                    <label for="date" class="form-label fw-bold">🗓️ Tarih</label>
                    <input type="date" name="date" id="date" class="form-control bg-dark text-white border-info" value="@ViewBag.Date" required />
                </div>

                <div class="col-md-3">
                    <label for="startTime" class="form-label fw-bold">⏱️ Başlangıç Saati</label>
                    <input type="time" name="startTime" id="startTime" class="form-control bg-dark text-white border-info" value="@ViewBag.StartTime" required />
                </div>

                <div class="col-md-3">
                    <label for="duration" class="form-label fw-bold">⏳ Süre (Dk)</label>
                    <input type="number" name="duration" id="duration" class="form-control bg-dark text-white border-info" value="@ViewBag.Duration" min="15" max="180" required />
                </div>

                <div class="col-md-3 d-grid">
                    <button type="submit" class="btn btn-success btn-lg shadow">
                        <i class="fas fa-magic me-1"></i> Eğitmenleri Bul
                    </button>
                </div>
            </form>
        </div>
    </div>

    @if (ViewBag.ErrorMessage != null)
    {
        <div class="alert alert-danger shadow-lg">
            <strong><i class="fas fa-exclamation-triangle me-1"></i> Hata:</strong> @ViewBag.ErrorMessage

            @if (ViewBag.ErrorDetails != null && !string.IsNullOrEmpty(ViewBag.ErrorDetails))
            {
                <p class="mt-2 mb-1"><strong>API Yanıt Detayı:</strong></p>
                <pre class="bg-dark text-danger p-2 rounded small overflow-auto" style="max-height: 200px;">@ViewBag.ErrorDetails</pre>
            }

            <small>Kontrol Edilen API Adresi: <code>@ViewBag.ApiUrl</code></small>

            <p class="mt-3">
                <i class="fas fa-lightbulb me-1"></i> Bu hata, ya API'den 404 (veri yok) ya da 500 (kod hatası) geldiğini gösterir. Lütfen detayları inceleyin.
            </p>
        </div>
    }
    else if (ViewBag.Date != null && !Model.Any())
    {
        <div class="alert alert-warning text-dark shadow-lg">
            <i class="fas fa-info-circle me-1"></i> Belirtilen tarih ve saat aralığında müsait eğitmen bulunamadı. Lütfen farklı bir saat deneyiniz.
        </div>
    }
    else if (Model.Any())
    {
        <h3><i class="fas fa-clipboard-list me-1"></i> Sorgu Sonuçları</h3>
        <p class="text-secondary">@Model.Count() adet müsait eğitmen bulundu.</p>

        <div class="table-responsive">
            <table class="table table-dark table-striped table-hover mt-4 shadow-lg align-middle">
                <thead>
                    <tr class="text-info border-bottom border-info">
                        <th><i class="fas fa-user-circle me-1"></i> Eğitmen Adı</th>
                        <th><i class="fas fa-medal me-1"></i> Uzmanlık Alanı</th>
                        <th><i class="fas fa-clock me-1"></i> Müsaitlik Zamanı</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Name</td>
                            <td><span class="badge bg-primary">@item.Specialty</span></td>
                            <td><span class="badge bg-success">@item.Availability</span></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <p class="mt-4 text-muted small">API Sorgusu: <code>@ViewBag.ApiUrl</code></p>
    }
</div>